<html>
<head>
    <title>Tour de Mock 4: EasyMock</title>
    <meta name="grackle.layout" content="post"/>
    <meta name="grackle.date-published" content="2009-07-23T11:15:00.000-05:00"/>
</head>
<body><a href="http://easymock.org/">EasyMock</a> is a bit of a different breed. The latest version (2.5.x) seems more
expressive than the previous version but it has an odd, and in my opinion cumbersome, need to call a replay method,
while most of the other mocking APIs seemingly either negate the need for this or do it under the covers so you don't
have to worry about it.<br/><a name='more'></a> The <tt>@Before</tt> method is nothing very different from the other
examples: <br/><br/>
<pre class="brush:java">@Before<br/>public void before() throws ServletException {<br/>        this.emailListService = createMock(EmailListService.class);<br/><br/>        final ServletConfig servletConfig = createMock(ServletConfig.class);<br/>        final ServletContext servletContext = createMock(ServletContext.class);<br/><br/>        expect(servletConfig.getServletContext()).andReturn(servletContext);<br/>        expect(servletContext.getAttribute(EmailListService.KEY)).andReturn(emailListService);<br/><br/>        replay(servletConfig,servletContext);<br/><br/>        this.servlet = new EmailListServlet();<br/>        servlet.init(servletConfig);<br/><br/>        this.request = createMock(HttpServletRequest.class);<br/>        this.response = createMock(HttpServletResponse.class);<br/>}</pre>
<br/>However, the code is reasonably expressive and gets the functional point across in a reasonable amount of code. The
exception test is expressive; however, again as in the <tt>before()</tt> method we see that clunky <tt>replay()</tt>
method that just feels like an out-of-place artifact of a poor design decision. <br/><br/>
<pre class="brush:java">@Test(expected=IOException.class)<br/>public void doGet_without_list() throws Exception {<br/> expect(request.getParameter("listName")).andReturn(null);<br/> expect(emailListService.getListByName(null)).andThrow(new IOException());<br/><br/> replay(request,emailListService);<br/><br/> servlet.doGet(request, response);<br/>}<br/></pre>
<br/>The sequential handling, in the "with list" test is fairly straight-forward, probably the least invasive of all the
APIs so far in handling method invocation sequences. <br/><br/>
<pre class="brush:java">@Test<br/>public void doGet_with_list() throws Exception {<br/> expect(request.getParameter("listName")).andReturn("foolist");<br/><br/> final List&lt;String&gt; list = Arrays.asList("larry@stooge.com","moe@stooge.com","curley@stooge.com");<br/> expect(emailListService.getListByName("foolist")).andReturn(list);<br/><br/> final PrintWriter writer = createMock(PrintWriter.class);<br/> checkOrder(writer,true);<br/> expect(response.getWriter()).andReturn(writer);<br/><br/> writer.println("larry@stooge.com");<br/> writer.println("moe@stooge.com");<br/> writer.println("curley@stooge.com");<br/> writer.close();<br/><br/> replay(request,response,writer,emailListService);<br/><br/> servlet.doGet(request, response);<br/> verify(writer);<br/>}</pre>
<br/>The code for the entire test case is as follows: <br/><br/>
<pre class="brush:java">public class EmailListServlet_EasyMockTest {<br/><br/> private EmailListServlet servlet;<br/> private HttpServletRequest request;<br/> private HttpServletResponse response;<br/> private EmailListService emailListService;<br/><br/> @Before<br/> public void before() throws ServletException {<br/>  this.emailListService = createMock(EmailListService.class);<br/><br/>  final ServletConfig servletConfig = createMock(ServletConfig.class);<br/>  final ServletContext servletContext = createMock(ServletContext.class);<br/><br/>  expect(servletConfig.getServletContext()).andReturn(servletContext);<br/>  expect(servletContext.getAttribute(EmailListService.KEY)).andReturn(emailListService);<br/><br/>  replay(servletConfig,servletContext);<br/><br/>  this.servlet = new EmailListServlet();<br/>  servlet.init(servletConfig);<br/><br/>  this.request = createMock(HttpServletRequest.class);<br/>  this.response = createMock(HttpServletResponse.class);<br/> }<br/><br/> @Test(expected=IOException.class)<br/> public void doGet_without_list() throws Exception {<br/>  expect(request.getParameter("listName")).andReturn(null);<br/>  expect(emailListService.getListByName(null)).andThrow(new IOException());<br/><br/>  replay(request,emailListService);<br/><br/>  servlet.doGet(request, response);<br/> }<br/><br/> @Test<br/> public void doGet_with_list() throws Exception {<br/>  expect(request.getParameter("listName")).andReturn("foolist");<br/><br/>  final List&lt;String&gt; list = Arrays.asList("larry@stooge.com","moe@stooge.com","curley@stooge.com");<br/>  expect(emailListService.getListByName("foolist")).andReturn(list);<br/><br/>  final PrintWriter writer = createMock(PrintWriter.class);<br/>  checkOrder(writer,true);<br/>  expect(response.getWriter()).andReturn(writer);<br/><br/>  writer.println("larry@stooge.com");<br/>  writer.println("moe@stooge.com");<br/>  writer.println("curley@stooge.com");<br/>  writer.close();<br/><br/>  replay(request,response,writer,emailListService);<br/><br/>  servlet.doGet(request, response);<br/><br/>  verify(writer);<br/> }<br/>}</pre>
<br/>Maybe it's because I am used to a different mocking strategy, or perhaps it's just an older API (I think EasyMock
was one of the first), but I am not really fond of EasyMock. It's another tool in the toolbox and I know there are quite
a few developers out there who swear by it. It's not one that I will use often. <br/>
<blockquote>You can find the source code used in this posting in my <a
        href="http://github.com/cjstehno/coffeaelectronica/tree/master/tourdemock">TourDeMock</a> project.
</blockquote>
</body>
</html>
