<html>
<head>
    <title>Java Preferences API</title>
    <meta name="grackle.layout" content="post"/>
    <meta name="grackle.date-published" content="2009-07-25T18:42:00.000-05:00"/>
</head>
<body>The Java Preferences API (java.util.preferences) appeared in the 1.4.x release of the JDK with little fanfare or
ceremony; it was just one of the new features in the release and it is not one that you hear about very often.<br/><a
        name='more'></a> I don't think I have ever seen it being used anywhere, but it is quite flexible and useful.
Preferences are references hierarchical by package name, similar to the Java Logging API (or <a
        href="http://logging.apache.org/">Log4J</a>). This allows for preferences to be stored a various levels (nodes)
of the hierarchy. There are two node branches availabe, the <tt>UserNode</tt> branch and the <tt>SystemNode</tt> branch.
The JavaDocs state that <br/>
<blockquote>The precise description of "user" and "system" will vary from implementation to implementation.</blockquote>
But, in general "user" preferences will be different for each user of an application, while system preferences are more
global in scope such as application configuration details. You retrieve the preferences for the class you are working
with with the following statement: <br/><br/>
<pre class="brush:java">Preferences userPrefs = Preferences.userNodeForPackage(com.you.MyClass.class);<br/>Preferences systemPrefs = Preferences.systemNodeForPackage(com.you.MyClass.class);<br/></pre>
<br/>You can really use any class in your application as a reference point, as long as it is a logical association. Once
you have a Preferences object, you can get and set values with simple accessor methods: <br/><br/>
<pre class="brush:java">userPrefs.putInt("historyCount",10);<br/>int histCnt = userPrefs.getInt("historyCount",5);<br/><br/>systemPrefs.putBoolean("allowEdit",true);<br/>boolean allowEdit = systemPrefs.getBoolean("allowEdit",false);<br/></pre>
<br/>Notice, that in the <tt>getInt()</tt> method the second parameter is a default value of the preference so that if
it has not been defined yet, you still have a value to fall back on. Also, the data is persisted automatically� you
don�t need to explicitly save it. If you want to export your preferences for backup or import into another system, the
API provides two export methods, one for just the current node, and the other for the current node and its child nodes.
<br/><br/>
<pre class="brush:java">userPrefs.exportNode( outstream ); // for just the one node, no child nodes<br/><br/>userPrefs.exportSubtree( outstream ); // for the node and its child nodes<br/></pre>
<br/>Importing preferences is done using the <tt>importPreferences(InputStream)</tt> method, which will import all the
given preferences into the local preference system. <br/><br/>
<pre class="brush:java">Preferences.importPreferences( instream );<br/></pre>
<br/>The import/export format for preferences is a defined XML format (see JavaDocs for DTD). The preferences I detailed
earlier would look something like (results may vary): <br/><br/>
<pre class="brush:xml">&lt;preferences&gt;<br/>    &lt;root type="user"&gt;<br/>        &lt;node name="com"&gt;<br/>            &lt;node name="you"&gt;<br/>                &lt;node name="MyClass"&gt;<br/>                    &lt;map&gt;<br/>                        &lt;entry key="historyCount" value="10" /&gt;<br/>                    &lt;/map&gt;<br/>                &lt;/node&gt;<br/>            &lt;/node&gt;<br/>        &lt;/node&gt;<br/>    &lt;/root&gt;<br/>    &lt;root type="system"&gt;<br/>        &lt;node name="com"&gt;<br/>            &lt;node name="you"&gt;<br/>                &lt;node name="MyClass"&gt;<br/>                    &lt;map&gt;<br/>                        &lt;entry key="allowEdit" value="false" /&gt;<br/>                    &lt;/map&gt;<br/>                &lt;/node&gt;<br/>            &lt;/node&gt;<br/>        &lt;/node&gt;<br/>    &lt;/root&gt;<br/>&lt;/preferences&gt;<br/></pre>
<br/>One more point of interest is that you can register a listener for node and preference change events: <br/><br/>
<pre class="brush:java">userPrefs.addNodeChangeListener( listener );<br/>userPrefs.addPreferenceChangeListener( listener );<br/></pre>
<br/>Node change events occur when a node is modified by adding or removing a child node. Preference change events are
fired when the data contained in a preference node is modified. These could be useful for cases when you have
interrelated preferences such that when you delete or change one of them, you need to modify the others accordingly. So,
the next time you think about using a <tt>Properties</tt> object, reconsider and think about whether or not a <tt>Preferences</tt>
object might serve your needs better.
</body>
</html>
