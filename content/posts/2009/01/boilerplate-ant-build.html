<html>
<head>
    <title>Boilerplate Ant Build</title>
    <meta name="grackle.layout" content="post"/>
    <meta name="grackle.date-published" content="2009-01-28T09:42:00.000-06:00"/>
</head>
<body>I have found it very useful to create a reusable boiler plate <a href="http://ant.apache.org/">Ant</a> <tt>build.xml</tt>
file that I use as a starting point for all my projects. With a little bit of configuration property tweaking and
perhaps a task modification here or there you have a standardized build environment which can be used by your IDE or on
the command line.<br/><a name='more'></a>I have provided a copy of my boilerplate build file at the bottom of this
posting. It is provided for use under a creative commons license (<a
        href="http://creativecommons.org/licenses/by/3.0/us/" rel="license" target="_blank">Creative Commons Attribution
    3.0 United States License</a>), so please maintain the copyright header if you use or extend it.<br/><br/>If you
look at the file you will see that the first section has all the properties you need. I used in-file properties rather
than a separate properties file because I don't really change them often for any given project and it keeps everything
all in one neat little file. Technically you could get more re-usability by using properties files, but that assumes
that you wont be modifying the build file itself for your project, which is something I do from time to time if
something is not quite right for the project.<br/><br/>The first thing you will want to do is update the project name
attribute to reflect the name of your project. Then you will want to update the configuration properties so that
everything is correct for your build environment. I tried to keep everything pretty standard so that they don't need to
change much between projects.<br/><br/>The first property is the <tt>war.name</tt> which is the name you want the
generated war file to have. I usually leave it set to the default, which is the project name. <br/><br/>
<pre class="brush:xml">&lt;property name="war.name" value="${ant.project.name}" /&gt;</pre>
<br/>The next set of properties are the locations of your source directories, which default to the same values that I
have set in my IDE. <br/><br/>
<pre class="brush:xml">&lt;property name="src.dir" value="src" /&gt;<br/>&lt;property name="test.src.dir" value="test" /&gt;<br/>&lt;property name="web.src.dir" value="web" /&gt;<br/></pre>
<br/>and then your external library directory. <br/><br/>
<pre class="brush:xml">&lt;property name="lib.dir" value="lib" /&gt;</pre>
<br/>There has been some confusion around the external library directory property when I have shown this to others. This
is not where all your libraries go, but where you put the libraries you <em>don't</em> want in the war file. Things like
JUnit and JMock jars go in there so that they are usable for testing and compiling but you don't really want them to go
into your deployed artifact. I the jars in this directory mapped on my classpath in my IDE too while those in the
WEB-INF/lib are picked up by default.<br/><br/>The next group of properties define the artifact build locations:
<br/><br/>
<pre class="brush:xml">&lt;property name="build.dir" value="build" /&gt;<br/>&lt;property name="src.build.dir" value="${build.dir}/classes" /&gt;<br/>&lt;property name="test.build.dir" value="${build.dir}/test-classes" /&gt;<br/>&lt;property name="test.report.dir" value="${build.dir}/test-reports" /&gt;<br/>&lt;property name="webapp.build.dir" value="${build.dir}/webapp" /&gt;<br/></pre>
<br/>As you can see, even if your <tt>build</tt> directory is called something else, like <tt>bin</tt> you can change
everything else by updating that one property, <tt>build.dir</tt>.<br/><br/>The next property is the location of your
local web server, where the war file would be deployed locally. The default is my symlink to the <tt>webapps</tt>
directory for my local <a href="http://tomcat.apache.org/">Tomcat</a> server installation. <br/><br/>
<pre class="brush:xml">&lt;property name="deploy.local.dir" value="/usr/local/tomcat/webapps" /&gt;</pre>
<br/>The final two properties are more environmental. You want to specifiy the JVM version you are targetting and
whether or not you want debugging information to be compiled with your classes. <br/><br/>
<pre class="brush:xml">&lt;property name="jvm.version" value="1.6" /&gt;<br/>&lt;property name="debug.enabled" value="true" /&gt;<br/></pre>
<br/>You probably wont change these all that often, though it might be a good idea to disable debugging on production
builds; I will have to look into supporting that. The <tt>jvm.version</tt> setting is nice because I think Ant still
defaults to 1.3 or something like that.<br/><br/>The next section of the file contains all the task definitions. You
will want to tweak these every now and then if you have special needs. You can run the Ant project help command (<tt>ant
    -p</tt>) to see the descriptions for all the tasks. Yes, I actually added descriptions for all of them.<br/><br/>Some
common tasks I use a lot are: <br/><br/>
<pre class="brush:text">ant clean-all test</pre>
<br/>Run all the tests on a clean build. <br/>
<pre class="brush:text">ant clean-all redeploy-local</pre>
<br/>Clean the build content and do a full local server redeployment. <br/>
<pre class="brush:text">ant clean-all test war</pre>
<br/>Run all the tests on a clean build and produce the war file.<br/><br/>I have used this in about five different
projects now and it comes in really handy to have a standardized base point, especially when you are in a hurry and
trying to do a quick command line build of the project; your commands are the same across your projects.<br/><br/>The
follow-up article to this one will delve more into using the Ant build as a tool set and about adding scripting layers
on top of the build to make repeated tasks bulletproof and quick.<br/><br/>Let me know if you have any suggestions for
modifications or additions to this basic build script. It is a work in progress as I try to bring more simplicity into
my development processes. <br/><br/>
<pre class="brush:xml">&lt;?xml version='1.0' ?&gt;<br/><br/>&lt;!--<br/>    Ant Build Template (v1.0)<br/>    Copyright (c) 2009 Christopher J. Stehno (chris@stehno.com)<br/>    Creative Commons Attribution 3.0 United States License (http://creativecommons.org/licenses/by/3.0/us/)<br/>    You are permitted to use this file in any personal and/or commercial product as long as you adhere to the above license.<br/>--&gt;<br/><br/>&lt;project name="project-name" default="war"&gt;<br/> <br/> &lt;!-- ============== --&gt;<br/> &lt;!-- Configurations --&gt;<br/> &lt;!-- ============== --&gt;<br/> <br/>    &lt;property name="war.name" value="${ant.project.name}" /&gt;<br/><br/>    &lt;property name="src.dir" value="src" /&gt;<br/>    &lt;property name="test.src.dir" value="test" /&gt;<br/><br/>    &lt;property name="web.src.dir" value="web" /&gt;<br/>    &lt;property name="lib.dir" value="lib" /&gt;<br/><br/>    &lt;property name="build.dir" value="build" /&gt;<br/>    &lt;property name="src.build.dir" value="${build.dir}/classes" /&gt;<br/>    &lt;property name="test.build.dir" value="${build.dir}/test-classes" /&gt;<br/>    &lt;property name="test.report.dir" value="${build.dir}/test-reports" /&gt;<br/>    &lt;property name="webapp.build.dir" value="${build.dir}/webapp" /&gt;<br/><br/>    &lt;property name="deploy.local.dir" value="/usr/local/tomcat/webapps" /&gt;<br/><br/>    &lt;property name="jvm.version" value="1.6" /&gt;<br/>    &lt;property name="debug.enabled" value="true" /&gt;<br/><br/>    &lt;path id="classpath"&gt;<br/>        &lt;fileset dir="${web.src.dir}/WEB-INF/lib" includes="**/*.jar" /&gt;<br/>        &lt;fileset dir="${lib.dir}" includes="**/*.jar" /&gt;<br/>    &lt;/path&gt;<br/><br/>    &lt;path id="test.classpath"&gt;<br/><br/>        &lt;path refid="classpath" /&gt;<br/>        &lt;pathelement path="${src.build.dir}" /&gt;<br/>    &lt;/path&gt;<br/><br/>    &lt;path id="test.runtime.classpath"&gt;<br/>        &lt;path refid="test.classpath" /&gt;<br/>        &lt;pathelement path="${test.build.dir}" /&gt;<br/>    &lt;/path&gt;<br/><br/>    &lt;!-- ======= --&gt;<br/>    &lt;!-- Targets --&gt;<br/> &lt;!-- ======= --&gt;<br/> <br/>    &lt;target name="compile" description="Compiles the java sources."&gt;<br/>        &lt;echo&gt;Compiling java sources...&lt;/echo&gt;<br/>        &lt;mkdir dir="${src.build.dir}" /&gt;<br/>        &lt;javac destdir="${src.build.dir}" classpathref="classpath" source="${jvm.version}" target="${jvm.version}" debug="${debug.enabled}"&gt;<br/>            &lt;src path="${src.dir}" /&gt;<br/>            &lt;include name="**/*.java" /&gt;<br/>        &lt;/javac&gt;<br/><br/>        &lt;echo&gt;Compiling java test sources...&lt;/echo&gt;<br/>        &lt;mkdir dir="${test.build.dir}" /&gt;<br/>        &lt;javac destdir="${test.build.dir}" classpathref="test.classpath" source="${jvm.version}" target="${jvm.version}" debug="${debug.enabled}"&gt;<br/>            &lt;src path="${test.src.dir}" /&gt;<br/>            &lt;include name="**/*.java" /&gt;<br/>        &lt;/javac&gt;<br/><br/>        &lt;echo&gt;Copying over confg files...&lt;/echo&gt;<br/>        &lt;copy todir="${src.build.dir}"&gt;<br/>            &lt;fileset dir="${src.dir}"&gt;<br/>                &lt;include name="**/*.xml" /&gt;<br/>                &lt;include name="**/*.properties" /&gt;<br/>            &lt;/fileset&gt;<br/>        &lt;/copy&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="clean-compile" description="Cleans up the compiled java sources."&gt;<br/>        &lt;delete dir="${src.build.dir}" /&gt;<br/>        &lt;delete dir="${test.build.dir}" /&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="test" depends="compile" description="Runs all the tests (compiles if necessary)."&gt;<br/>        &lt;echo&gt;Running unit tests...&lt;/echo&gt;<br/>        &lt;mkdir dir="${test.report.dir}" /&gt;<br/><br/>        &lt;junit printsummary="yes" haltonfailure="yes"&gt;<br/>            &lt;classpath refid="test.runtime.classpath" /&gt;<br/>            &lt;formatter type="plain" /&gt;<br/>            &lt;batchtest fork="yes" todir="${test.report.dir}"&gt;<br/>                &lt;fileset dir="${test.build.dir}" includes="**/*Test.class" /&gt;<br/>            &lt;/batchtest&gt;<br/>        &lt;/junit&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="clean-test" description="Cleans out all of the tests and test data."&gt;<br/>        &lt;delete dir="${test.report.dir}" /&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="webapp" depends="compile" description="Builds the exploded web application (compiles if necessary)."&gt;<br/>        &lt;echo&gt;Building web application...&lt;/echo&gt;<br/><br/>        &lt;mkdir dir="${webapp.build.dir}" /&gt;<br/>        &lt;copy todir="${webapp.build.dir}"&gt;<br/>            &lt;fileset dir="${web.src.dir}"&gt;<br/>                &lt;include name="**/*.*" /&gt;<br/>            &lt;/fileset&gt;<br/>        &lt;/copy&gt;<br/><br/>        &lt;mkdir dir="${webapp.build.dir}/WEB-INF/classes" /&gt;<br/>        &lt;copy todir="${webapp.build.dir}/WEB-INF/classes"&gt;<br/>            &lt;fileset dir="${src.build.dir}"&gt;<br/>                &lt;include name="**/*.*" /&gt;<br/>            &lt;/fileset&gt;<br/>        &lt;/copy&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="clean-webapp" description="Cleans up the exploded web application."&gt;<br/>        &lt;delete dir="${webapp.build.dir}" /&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="war" depends="webapp" description="Builds the war file (builds the webapp if necessary)."&gt;<br/>        &lt;echo&gt;Building the war file...&lt;/echo&gt;<br/>        &lt;jar destfile="${build.dir}/${war.name}.war"&gt;<br/>            &lt;fileset dir="${webapp.build.dir}" /&gt;<br/>        &lt;/jar&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="clean-war" description="Cleans up the war file."&gt;<br/>        &lt;delete file="${build.dir}/${war.name}.war" /&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="clean-all" depends="clean-compile,clean-test,clean-webapp,clean-war" description="Cleans up all generated content." /&gt;<br/><br/>    &lt;target name="deploy-local" depends="war" description="Deploys the war to the locally configured server location."&gt;<br/>        &lt;echo&gt;Deploying war to local server (${deploy.local.dir})...&lt;/echo&gt;<br/>        &lt;copy todir="${deploy.local.dir}" file="${build.dir}/${war.name}.war"&gt;<br/>        &lt;/copy&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="undeploy-local" description="Removes the war (and exploded webapp) from the local server."&gt;<br/>        &lt;delete file="${deploy.local.dir}/${war.name}.war" /&gt;<br/>        &lt;delete dir="${deploy.local.dir}/${war.name}" /&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="deploy-remote" depends="war,-prompt-for-server" description="Deploys the war file to the configured remote server (scp only)."&gt;<br/>        &lt;echo&gt;Deploying war file to remote server via scp...&lt;/echo&gt;<br/>        &lt;scp file="${build.dir}/${war.name}.war" todir="${deploy.remote.conn}" /&gt;<br/>        &lt;echo&gt;You will need to finish the deployment from the server box.&lt;/echo&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="-prompt-for-server" unless="deploy.remote.conn"&gt;<br/>        &lt;input message="Enter connection string (user:pass@server:path):" addproperty="deploy.remote.conn" defaultvalue="" /&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="archive" depends="clean-all" description="Cleans up and archives the project in a time-stampped zip file one directory up."&gt;<br/>        &lt;echo&gt;Creating archive of project...&lt;/echo&gt;<br/>        &lt;tstamp /&gt;<br/>        &lt;zip destfile="../${ant.project.name}-${DSTAMP}-${TSTAMP}.zip" compress="yes" basedir="." /&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="sync-webapp" description="Syncs up the locally configured webapp content with the project."&gt;<br/>        &lt;echo&gt;Sync-ing the web code with local exploded war...&lt;/echo&gt;<br/>        &lt;copy todir="${deploy.local.dir}/${war.name}"&gt;<br/>            &lt;fileset dir="${web.src.dir}"&gt;<br/>                &lt;exclude name="WEB-INF/**/*.*" /&gt;<br/>            &lt;/fileset&gt;<br/>        &lt;/copy&gt;<br/>    &lt;/target&gt;<br/><br/>    &lt;target name="redeploy-local" depends="undeploy-local,deploy-local" description="Redeploys the local webapp (undeploy and deploy)." /&gt;<br/>&lt;/project&gt;<br/></pre>
<blockquote>You can find an updated version of this build script in my <a
        href="http://github.com/cjstehno/AntBoilerplate">AntBoilerplate</a> project.
</blockquote>
</body>
</html>
