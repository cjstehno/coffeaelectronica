
<html><head>
<title>Integration Testing with JUnit and Maven</title>
<meta name="grackle.layout" content="post" />
<meta name="grackle.date-published" content="2013-02-09T09:10:00.000-06:00" />
</head><body><br />When I talk about unit testing, I generally mean small quick and mocked tests of individual chunks of functionality, traditional unit testing. In some cases I will be testing slightly larger chunks, such as the interaction of a controller and a service, with everything else mocked out; however, when you start using a real database (especially not an embedded one) or needing to connect to other services in order to get a good solid test, you cross over into the realm of integration testing.<br /><a name='more'></a>Recently on one of my projects I had DAO integration tests that require a real database to test against, and it is not embeddable (PostgreSQL using some non-standard features). I used a system property check to ensure that these integration tests only ran when I wanted them to so that I could ensure that there was a database ready to test against. You would have something like the following in your unit test:<br /><br /><pre class="brush:text">assumeTrue( "true".equalsIgnoreCase(System.getProperty("integration")) );</pre><br />which would only continue with the test if the assumption was true, otherwise it stops without failing the test. With this, when I wanted to run the integration tests I would just run them with that property, e.g.:<br /><br /><pre class="brush:text">mvn test -Dintegration=true</pre><br />This works, and it's not a horrible solution, but it does get annoying when testing from an IDE since you have to keep setting that property on any new test runners, which can slow things down.<br /><br />A better way would be to have the test be no different than any other test so that if you want to run it, you run it, if not, you don't. I figured that there had to be a solution to this problem out there so a little research was in order. I found out that maven has an "integration-test" phase (since Maven 3) and that there is a fork of the <a href="http://maven.apache.org/surefire/maven-surefire-plugin/">surefire</a> testing plugin called <a href="http://maven.apache.org/surefire/maven-failsafe-plugin/">failsafe</a> to take advantage of this build phase.<br /><br />Surefire is the unit test running plugin used by maven. You usually don't even realize it's there; Unless you have some special configuration needs it just runs your tests for you. The failsafe fork of the plugin does the same functionality but with slightly different configuration. Failsafe looks for tests ending in "IT" for "integration test" rather than "Test" as a normal JUnit test. Also, failsafe runs in the integration-test phase rather rather than the test phase.<br /><br />Now what I needed was a simple way to take advantage of this build phase. I could have used the naming patterns, but I prefer the "Test" suffix and wanted another option. I found an interesting alternative, the experimental categories feature in <a href="http://junit.org/">JUnit</a> (4.9+).<br /><br />To get this running, you need to have something like the following config in your maven build plugins:<br /><br /><pre class="brush:xml">&lt;plugin&gt;<br />	&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br />	&lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;<br />	&lt;version&gt;2.13&lt;/version&gt;<br />	&lt;configuration&gt;<br />		&lt;excludedGroups&gt;com.coffeaelectronica.Integration&lt;/excludedGroups&gt;<br />	&lt;/configuration&gt;<br />&lt;/plugin&gt;<br />&lt;plugin&gt;<br />	&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br />	&lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;<br />	&lt;version&gt;2.13&lt;/version&gt;<br />	&lt;executions&gt;<br />		&lt;execution&gt;<br />			&lt;goals&gt;<br />				&lt;goal&gt;integration-test&lt;/goal&gt;<br />				&lt;goal&gt;verify&lt;/goal&gt;<br />			&lt;/goals&gt;<br />		&lt;/execution&gt;<br />	&lt;/executions&gt;<br />	&lt;configuration&gt;<br />		&lt;groups&gt;com.coffeaelectronica.Integration&lt;/groups&gt;<br />		&lt;includes&gt;<br />			&lt;include&gt;**/*Test.*&lt;/include&gt;<br />		&lt;/includes&gt;<br />	&lt;/configuration&gt;<br />&lt;/plugin&gt;<br /></pre><br />This tells surefire to ignore any JUnit tests annotated with the Integration annotation and then configures failsafe to only consider classes ending in "Test" and having the Integration annotation. Remember, by default failsafe looks for "**/*IT.*".<br /><br />With this, your tests either have no Category annotation, for a normal test, or something like the example shown below for Integration tests:<br /><br /><pre class="brush:java">@Category(Integration.class)<br />public class SomeDaoTest {<br />    // your integration test methods...<br />}</pre><br /><div>Now, when you run:<br /><br /><pre class="brush:text">mvn test</pre><br />You get only your normal unit tests being run, while running<br /><br /><pre class="brush:text">mvn integration-test</pre><br />will run only your integration tests.<br /><br />Along with this, you retain the ability to run any single test in your IDE without having to do any extra configuration.</div></body></html>
