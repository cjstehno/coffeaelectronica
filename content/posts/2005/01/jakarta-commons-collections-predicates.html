<html>
<head>
    <title>Jakarta Commons Collections - Predicates</title>
    <meta name="grackle.layout" content="post"/>
    <meta name="grackle.date-published" content="2005-01-04T08:27:00.000-06:00"/>
    <meta name="grackle.tags" content="Java"/>
    <meta name="grackle.summary" content="A look at Predicates in the Jakarta Commons Collections."/>
</head>
<body>

<p>Nestled in the <a href="http://commons.apache.org/">Jakarta Commons</a> project is a monstrosity called the
    <a href="http://commons.apache.org/collections">Jakarta Commons - Collections</a> API. It contains a wealth of
extensions to the standard collections as well as new collections and collection-related utilities. To try and document
the use of the whole API would be a good topic for a book (and there are a few:
    <a href="http://www.amazon.com/s/ref=br_ss_hs/103-3887221-2235807?platform=gurupa&amp;url=index%3Dblended&amp;keywords=jakarta+commons&amp;Go.x=0&amp;Go.y=0&amp;Go=Go">"on Amazon</a>).
    I am going to cover one of my favorite interfaces from this API, the Predicate, and its
implementations.<br/><a name='more'></a>From the documentation for the Predicate interface:</p>

<blockquote>A Predicate defines a functor interface implemented by classes that perform a predicate test on an object. Predicate
    instances can be used to implement queries or to do filtering.</blockquote>

<p>That sums it up pretty well; but, how do you use it?</p>

<h2>General Usage</h2>

<p>Let's say we have an <code>ArrayList</code> containing ten <code>Integer</code> objects as
follows:</p>

<pre>List&lt;Integer&gt; numbers = new ArrayList&lt;Integer&gt;();
for(int i=0; i&lt;10; i++){
    numbers.add(i);
}</pre>

<p>Now let's say that for some reason only the even numbers in the list are relevant and that the rest can be ignored
and/or removed. There are three main approaches to doing this with Predicates. First, you can select all even numbers
from the list into a new <code>Collection</code>. Second, you can filter the list so that all non-even numbers are removed
from the list. Third, you can create a predicated list that will only store even numbers.</p>

<p>Before we go any farther, we need a Predicate to work with. The Predicate interface is pretty simple, containing only a single method to
implement, so I will just show it below:</p>

<pre>public class EvenIntegerPredicate implements Predicate {
    public boolean evaluate(Object obj){
        boolean accept = false;
        if(obj instanceof Integer){
            accept = ((Integer)obj).intValue() % 2 == 0;
        }
        return(accept);
    }
}</pre>

<p>The <code>evaluate()</code> method is called for each element to be tested. In this case, the object must be an Integer
implementation and have an even value to be accepted.</p>

<h2>Select the Even Numbers</h2>

<p>This case uses the <code>select(Collection,Predicate)</code> method of the <code>CollectionUtils</code>
class. This method selects all elements from input collection which match the given predicate into an output collection.</p>

<pre>Predicate evenPred = new EvenIntegerPredicate();
Collection nums = CollectionUtils.select(numbers,evenPred);</pre>

<p>which will yield a new collection containing only the even numbers from the original list while the original list
will remain unchanged.</p>

<h2>Filter the Collection</h2>

<p>This next method is good when you are able to reuse the original collection once it is filtered. The
    <code>CollectionUtils.filter(Collection,Predicate)</code> method filters the collection by testing each element and
    removing any that the predicate rejects.</p>

<pre>CollectionUtils.filter(numbers,new EvenIntegerPredicate());</pre>

<p>Once again, only the even values are preserved; however, this time, the original collection is
maintained.</p>

<h2>Predicated List</h2>

<p>In the third approach, we use a method that allows new values to be added to the list and
tested at the same time. This approach is best when you have control over the original collection and could possibly add
new elements to the collection. For this we use the <code>predicatedList(List,Predicate)</code> method of the
<code>ListUtils</code> class which returns a predicated list backed by the given list. Only values that are accepted by the
predicate will be added to the list any other values will cause an <code>IllegalArgumentException</code> to be thrown.</p>

<pre>List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();
Predicate evenPred = new EvenIntegerPredicate();
List predList = ListUtils.predicatedList(list,evenPred);
predList.add(new Integer(2));
predList.add(new Integer(4));
predList.add(new Integer(6));
predList.add(new Integer(8));
predList.add(new Integer(10));

// this next one will throw an IllegalArgumentException
predList.add(new Integer(11));</pre>

<p>The resulting list will contain only the even values (you should be sure to use the predicated list (predList) not
the original backing list.</p>

<h2>Combining Predicates</h2>

<p>I will take this discussion one step farther and pose the question, "what if you only
want even integers greater than 5?" Your first thought might be to re-write the <code>EvenIntegerPredicate</code> to handle
this, but a better approach would be to write a new predicate that only accepts values greater than a specified value.</p>

<pre>public class GreaterThanPredicate implements Predicate {
    private int value;

    public GreaterThanPredicate(int value){
        this.value = value;
    }

    public boolean evaluate(Object obj){
        boolean accept = false;
        if(obj instanceof Integer){
            accept = ((Integer)obj).intValue() &gt; value;
        }
        return(accept);
    }
}</pre>

<p>Now we have a predicate that matches even numbers and a predicate that matches numbers greater than a specified
number... how do we combine them? Two Predicate implementations jump to mind, <code>AllPredicate</code> and
<code>AndPredicate</code>. The <code>AllPredicate</code> is built with an array of Predicates that must all evaluate to true for
the containing predicate to be true. The <code>AndPredicate</code>, which we will use here, takes two predicates as
arguments and returns true if both evaluate to true.</p>

<pre>Predicate evenInt = new EvenIntegerPredicate();
Predicate greater = new GreaterThanPredicate(5);
Predicate andPred = new AndPredicate(evenInt,greater);</pre>

<p>which could be used in any of the previous examples to accept only even numbers greater than 5.</p>

<h2>Conclusion</h2>

<p>Predicates are a powerful tool for object filtering and searching. They are fairly simple to
learn and if written properly, very reusable. At first they may feel a bit like excess code, but once you find yourself
using the same predicate in multiple projects, you will see the benefits.</p>

</body>
</html>
