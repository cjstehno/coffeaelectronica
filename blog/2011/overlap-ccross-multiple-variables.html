<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CoffeaElectronica.com</title>

    <meta name="description" content="A technical blog.">
    <meta name="author" content="Christopher J. Stehno">
    <meta name="keywords" content="java,groovy,blog">
    <meta name="generator" content="JBake">

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/asciidoctor.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <link href="/css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="shortcut icon" href="/favicon.ico">
</head>

<body onload="prettyPrint()">

<div class="container-fluid">

    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
            <img src="/images/coffee-banner.jpg" class="img-responsive" />
        </div>
    </div>

    <nav class="navbar navbar-inverse" style="margin-bottom: 2px;">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/index.html">&nbsp;CoffeaElectronica</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li><a href="/index.html">Home</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/feed.xml">Feed</a></li>
                    <li><a href="/archive.html">Archive</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tags <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            
                                    <li><a href="/tags/ant.html">ant</a></li>
                            
                                    <li><a href="/tags/blog.html">blog</a></li>
                            
                                    <li><a href="/tags/gradle.html">gradle</a></li>
                            
                                    <li><a href="/tags/groovy.html">groovy</a></li>
                            
                                    <li><a href="/tags/java.html">java</a></li>
                            
                                    <li><a href="/tags/javascript.html">javascript</a></li>
                            
                                    <li><a href="/tags/maven.html">maven</a></li>
                            
                                    <li><a href="/tags/python.html">python</a></li>
                            
                                    <li><a href="/tags/spring.html">spring</a></li>
                            
                                    <li><a href="/tags/testing.html">testing</a></li>
                            
                                    <li><a href="/tags/vanilla.html">vanilla</a></li>
                            
                        </ul>
                    </li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>

	
	<h1>Determining Overlap Across Multiple Variables</h1>

	<p><em><span class="glyphicon glyphicon-calendar"></span> 05 September 2011</em> ~ <a href='/tags/blog.html'><span class='label label-success'><span class='glyphicon glyphicon-tag'></span> blog</span></a>, <a href='/tags/java.html'><span class='label label-success'><span class='glyphicon glyphicon-tag'></span> java</span></a>, <a href='/tags/groovy.html'><span class='label label-success'><span class='glyphicon glyphicon-tag'></span> groovy</span></a></p>

	<p><p>I have run into two cases now where I have needed to validate that no overlap exists for data across three axes of<br/>comparison, each with potentially large value-spaces containing single values and/or ranges of values. An example of<br/>such a comparison could be something like a filter rule used to find People based on demographic data.</p><p>Say we have a search rule to find males between 15 and 25 years old who weigh 200 to 300 pounds.<br/>You could have something like:</p>
<pre><code>People A
Ages: 15-25
Gender: M
Weight: 200-300
</code></pre><p>Now consider the case when you have other search rules in the same search and that for the sake of efficiency we want to<br/>find overlapping rules and merge them into one (we will only consider the overlap determination here). With two other<br/>rules:</p>
<pre><code>People B
Ages: 13-20
Gender: M
Weight: 250-400

People C
Ages: 8-10
Gender: M
Weight: 200-300
</code></pre><p>It's not hard to look at the rules and determine which ones overlap. "People A" overlaps with "People B", while "People C"<br/>does not overlap with either of the other two. Programmatically this can be a difficult comparison to do correctly and<br/>efficiently. Also, as your number of comparison axes increases, so does the complexity of determining overlap for any given<br/>pair of objects.</p><p>What is needed is a simple means of determining the overlap of two objects and the best way I have found to do that is to<br/>break each object down into its overlap-comparison components, each of which I will call a "Lobe" from here on out. I chose<br/>the term lobe because it is defined as:</p>
<blockquote><p>"any rounded projection forming part of a larger structure"</p>
</blockquote><p>Also, terms like element and node are used far too much already in programming.</p><p>When you break each object down into it's lobes, you will have one lobe for Gender, one for Ages, and one for weights. Now<br/>you can build your overlap determination based on whether or not each lobe overlaps with its corresponding lobe on the<br/>other object. If all of the lobes overlap those of the other object, then the two objects are considered overlapping,<br/>otherwise they are not. This allows for a fail-fast comparison since if the comparison of any given lobe fails, you cannot<br/>have an overlapping object and no further comparison is necessary.<br/><br/>Programmatically a lobe can be defined by interface as:</p>
<pre><code class="groovy">interface Lobe {
    boolean overlaps( Lobe other )
}
</code></pre><p>Each lobe implementation defines what it means to overlap another Lobe of the same type. Using Groovy and some<br/>generic logic we can easily come up with a<br/><a href="https://github.com/cjstehno/vanilla/blob/master/vanilla-core/src/main/groovy/com/stehno/vanilla/overlap/ComparableLobe.groovy">ComparableLobe</a><br/>which is based on single values and ranges of Comparable objects such as numbers, strings and ranges. This allows us to<br/>do things like:</p>
<pre><code class="groovy">new ComparableLobe( 10..20, 50, 75 )
new ComparableLobe( &#39;a&#39;, &#39;h&#39;..&#39;j&#39;, &#39;m&#39; )

lobeA.overlaps( lobeB )
</code></pre><p>which can make the overlap determination very flexible.</p>
<blockquote><p><em>Note:</em> All of the source code from this article is available in my <a href="http://github.com/">GitHub</a> repo called <a href="https://github.com/cjstehno/vanilla/tree/master/vanilla-core/src/main/groovy/com/stehno/vanilla/overlap">Overlap</a>.</p>
</blockquote><p>Now we can create Lobes for each of the overlap-comparable parts of our People, using "People A" as an<br/>example:</p>
<pre><code class="groovy">def genderLobe = new ComparableLobe( &#39;M&#39; )
def agesLobe = new ComparableLobe( 15..25 )
def weightsLobe = new ComparableLobe( 200..300 )
</code></pre><p>The next thing we need is a way of comparing these lobes in a simple and repeatable manner and that's where the<br/><a href="https://github.com/cjstehno/vanilla/blob/master/vanilla-core/src/main/groovy/com/stehno/vanilla/overlap/Overlappable.groovy">Overlappable</a> interface<br/>comes in:</p>
<pre><code class="groovy">interface Overlappable {
    boolean overlaps ( Overlappable other )
}
</code></pre><p>The Overlappable interface defines an object that can be compared for overlap. The required method is basically the<br/>same as that of the Lobe; however, this interface is for the parent object itself. By providing an abstract<br/>implementation of this interface we have a nice clean way of providing overlap detection functionality for an object<br/>type. The <a href="https://github.com/cjstehno/vanilla/blob/master/vanilla-core/src/main/groovy/com/stehno/vanilla/overlap/Overlappable.groovy">AbstractOverlappable</a><br/>provides an implementation of the overlaps() method using the OverlapBuilder, which we will talk about in a minute. What<br/>the abstract class also provides is a simple way of emitting the Lobes for the given object in a simple manner, as an<br/>array. You can use this with our example above to create a simple Overlappable Person object:</p>
<pre><code class="groovy">class People extends AbstractOverlappable {
    String gender
    IntRange ages
    IntRange weights

    @Override Lobe[] lobes() {
        [
            new ComparableLobe(gender),
            new ComparableLobe(ages),
            new ComparableLobe(weights)
        ]
    }
}
</code></pre><p>The overlaps() method uses the provided Lobes to popualte an<br/><a href="https://github.com/cjstehno/vanilla/blob/master/vanilla-core/src/main/groovy/com/stehno/vanilla/overlap/OverlapBuilder.groovy">OverlapBuilder</a>,<br/>which is basically a helper class for performing the actual Lobe-to-Lobe comparison of a given set of Lobes. The<br/>OverlapBuilder is inspired by the builder in the Apache Commons - Lang API, such as EqualsBuilder and HashCodeBuilder.<br/>You create an instance and append your Lobes to it, then execute the overlap() method to perform the comparison.</p>
<pre><code class="groovy">new OverlapBuilder()
    .appendLobe(new ComparableLobe(1..10), new ComparableLobe(5..15))
    .overlap()
</code></pre><p>It also provides an append method for simple comparable cases:</p>
<pre><code class="groovy">overlapBuilder.appendComparable( 20..25, 15..30 )
</code></pre><p>which just wraps each value in a <code>ComparableLobe</code>. Now, given a list of People objects, you can determine if any<br/>of them overlap any of the others simply by iterating over the list and comparing each element with the<br/>others:</p>
<pre><code class="groovy">def list = [
    new Person( gender:&#39;M&#39;, ages:15..25, weights:200..300 ),
    new Person( gender:&#39;M&#39;, ages:13..20, weights:250..400 ),
    new Person( gender:&#39;M&#39;, ages:8..10, weights:200..300 )
]

list[0..-2].eachWithIndex { self, idx-&gt;
    list[(idx+1)..(-1)].each { other-&gt;
        if( self.overlaps( other ) ){
            println &quot;$self overlaps $other&quot;
        }
    }
}
</code></pre><p>As a final little bonus feature, I have added a <code>ComparableLobe.ANY</code> object which denotes a Lobe that will always be<br/>considered to overlap, no matter what the other value is.</p><p>This kind of multi-variable overlap-checking scenario may not come up all that often, but when it does, it can give you<br/>a lot of grief, especially if the fields being compared are numerous and complex. I have had to create a couple<br/>additional Lobe implementations but am also using the <code>ComparableLobe</code> quite a bit. This library has been a real<br/>time-saver. And, once broken down into component parts, the overlap determination becomes simple to implement and test,<br/>which makes it much more stable over time.</p>
<blockquote><p>Update: I have updated the <a href="https://github.com/cjstehno/vanilla/tree/master/vanilla-core/src/main/groovy/com/stehno/vanilla/overlap">Overlap code</a> and added it to my <a href="http://stehno.com/vanilla/">Vanilla</a> library. There have a been a few changes, but the overall usage described here remains the same.</p>
</blockquote></p>

	<hr />
	

            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <hr>
                    <div style="text-align:center;">
                        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a> CoffeaElectronica.com content is copyright &copy; 2016 <a href="http://stehno.com">Christopher J. Stehno</a> and available under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
                    </div>
                </div>
            </div>

        </div>

        <script src="js/jquery-1.12.4.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/prettify.js"></script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-27165855-1', 'auto');
            ga('send', 'pageview');
        </script>
    </body>
</html>