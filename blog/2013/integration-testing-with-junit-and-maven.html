<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CoffeaElectronica.com</title>

    <meta name="description" content="A technical blog.">
    <meta name="author" content="Christopher J. Stehno">
    <meta name="keywords" content="java,groovy,blog">
    <meta name="generator" content="JBake">

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/asciidoctor.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <link href="/css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="shortcut icon" href="/favicon.ico">
</head>

<body onload="prettyPrint()">

<div class="container-fluid">

    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
            <img src="/images/coffee-banner.jpg" class="img-responsive" />
        </div>
    </div>

    <nav class="navbar navbar-inverse" style="margin-bottom: 2px;">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/index.html">&nbsp;CoffeaElectronica</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li><a href="/index.html">Home</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/feed.xml">Feed</a></li>
                    <li><a href="/archive.html">Archive</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tags <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            
                                    <li><a href="/tags/ant.html">ant</a></li>
                            
                                    <li><a href="/tags/blog.html">blog</a></li>
                            
                                    <li><a href="/tags/gradle.html">gradle</a></li>
                            
                                    <li><a href="/tags/groovy.html">groovy</a></li>
                            
                                    <li><a href="/tags/java.html">java</a></li>
                            
                                    <li><a href="/tags/javascript.html">javascript</a></li>
                            
                                    <li><a href="/tags/maven.html">maven</a></li>
                            
                                    <li><a href="/tags/python.html">python</a></li>
                            
                                    <li><a href="/tags/spring.html">spring</a></li>
                            
                                    <li><a href="/tags/testing.html">testing</a></li>
                            
                                    <li><a href="/tags/vanilla.html">vanilla</a></li>
                            
                        </ul>
                    </li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>

	
	<h1>Integration Testing with JUnit and Maven</h1>

	<p><em><span class="glyphicon glyphicon-calendar"></span> 09 February 2013</em> ~ <a href='/tags/blog.html'><span class='label label-success'><span class='glyphicon glyphicon-tag'></span> blog</span></a>, <a href='/tags/java.html'><span class='label label-success'><span class='glyphicon glyphicon-tag'></span> java</span></a>, <a href='/tags/maven.html'><span class='label label-success'><span class='glyphicon glyphicon-tag'></span> maven</span></a>, <a href='/tags/testing.html'><span class='label label-success'><span class='glyphicon glyphicon-tag'></span> testing</span></a></p>

	<p><p>When I talk about unit testing, I generally mean small quick and mocked tests of individual chunks of functionality,<br/>traditional unit testing. In some cases I will be testing slightly larger chunks, such as the interaction of a<br/>controller and a service, with everything else mocked out; however, when you start using a real database (especially<br/>not an embedded one) or needing to connect to other services in order to get a good solid test, you cross over into the<br/>realm of integration testing.</p><p>Recently on one of my projects I had DAO integration tests that require a real database to test against, and it is not<br/>embeddable (PostgreSQL using some non-standard features). I used a system property check to ensure that these integration<br/>tests only ran when I wanted them to so that I could ensure that there was a database ready to test against. You would<br/>have something like the following in your unit test:</p>
<pre><code class="java">assumeTrue( &quot;true&quot;.equalsIgnoreCase(System.getProperty(&quot;integration&quot;)) );
</code></pre><p>which would only continue with the test if the assumption was true, otherwise it stops without failing the test. With<br/>this, when I wanted to run the integration tests I would just run them with that property, e.g.:</p>
<pre><code>mvn test -Dintegration=true
</code></pre><p>This works, and it's not a horrible solution, but it does get annoying when testing from an IDE since you have to keep<br/>setting that property on any new test runners, which can slow things down.</p><p>A better way would be to have the test be no different than any other test so that if you want to run it, you run it,<br/>if not, you don't. I figured that there had to be a solution to this problem out there so a little research was in order.<br/>I found out that maven has an "integration-test" phase (since Maven 3) and that there is a fork of the<br/><a href="http://maven.apache.org/surefire/maven-surefire-plugin/">surefire</a> testing plugin called<br/><a href="http://maven.apache.org/surefire/maven-failsafe-plugin/">failsafe</a><br/>to take advantage of this build phase.</p><p>Surefire is the unit test running plugin used by maven. You usually don't even realize it's there; Unless you have some<br/>special configuration needs it just runs your tests for you. The failsafe fork of the plugin does the same functionality<br/>but with slightly different configuration. Failsafe looks for tests ending in "IT" for "integration test" rather than<br/>"Test" as a normal JUnit test. Also, failsafe runs in the integration-test phase rather rather than the test phase.</p><p>Now what I needed was a simple way to take advantage of this build phase. I could have used the naming patterns, but I<br/>prefer the "Test" suffix and wanted another option. I found an interesting alternative, the experimental categories<br/>feature in <a href="http://junit.org/">JUnit</a> (4.9+).</p><p>To get this running, you need to have something like the following config in your maven build plugins:</p>
<pre><code class="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.13&lt;/version&gt;
    &lt;configuration&gt;
        &lt;excludedGroups&gt;com.coffeaelectronica.Integration&lt;/excludedGroups&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.13&lt;/version&gt;
        &lt;executions&gt;
            &lt;execution&gt;
                &lt;goals&gt;
                    &lt;goal&gt;integration-test&lt;/goal&gt;
                    &lt;goal&gt;verify&lt;/goal&gt;
                &lt;/goals&gt;
            &lt;/execution&gt;
        &lt;/executions&gt;
    &lt;configuration&gt;
        &lt;groups&gt;com.coffeaelectronica.Integration&lt;/groups&gt;
        &lt;includes&gt;
            &lt;include&gt;**/*Test.*&lt;/include&gt;
        &lt;/includes&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre><p>This tells surefire to ignore any JUnit tests annotated with the Integration annotation and then configures failsafe to only consider classes ending in "Test" and having the Integration annotation. Remember, by default failsafe looks for "**/*IT.*".</p><p>With this, your tests either have no Category annotation, for a normal test, or something like the example shown below for Integration tests:</p>
<pre><code class="java">@Category(Integration.class)
public class SomeDaoTest {
    // your integration test methods...
}
</code></pre><p>Now, when you run:</p>
<pre><code>mvn test
</code></pre><p>You get only your normal unit tests being run, while running</p>
<pre><code>mvn integration-test
</code></pre><p>will run only your integration tests.</p><p>Along with this, you retain the ability to run any single test in your IDE without having to do any extra configuration.</p></p>

	<hr />
	

            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <hr>
                    <div style="text-align:center;">
                        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a> CoffeaElectronica.com content is copyright &copy; 2016 <a href="http://stehno.com">Christopher J. Stehno</a> and available under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
                    </div>
                </div>
            </div>

        </div>

        <script src="js/jquery-1.12.4.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/prettify.js"></script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-27165855-1', 'auto');
            ga('send', 'pageview');
        </script>
    </body>
</html>