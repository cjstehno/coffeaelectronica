<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CoffeaElectronica.com</title>

    <meta name="description" content="A technical blog.">
    <meta name="author" content="Christopher J. Stehno">
    <meta name="keywords" content="java,groovy,blog">
    <meta name="generator" content="JBake">

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/asciidoctor.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <link href="/css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="shortcut icon" href="/favicon.ico">
</head>

<body onload="prettyPrint()">

<div class="container-fluid">

    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
            <img src="/images/coffee-banner.jpg" class="img-responsive" />
        </div>
    </div>

    <nav class="navbar navbar-inverse" style="margin-bottom: 2px;">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/index.html">&nbsp;CoffeaElectronica</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li><a href="/index.html">Home</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/feed.xml">Feed</a></li>
                    <li><a href="/archive.html">Archive</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tags <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            
                                    <li><a href="/tags/ant.html">ant</a></li>
                            
                                    <li><a href="/tags/blog.html">blog</a></li>
                            
                                    <li><a href="/tags/gradle.html">gradle</a></li>
                            
                                    <li><a href="/tags/groovy.html">groovy</a></li>
                            
                                    <li><a href="/tags/java.html">java</a></li>
                            
                                    <li><a href="/tags/javascript.html">javascript</a></li>
                            
                                    <li><a href="/tags/maven.html">maven</a></li>
                            
                                    <li><a href="/tags/python.html">python</a></li>
                            
                                    <li><a href="/tags/spring.html">spring</a></li>
                            
                                    <li><a href="/tags/testing.html">testing</a></li>
                            
                                    <li><a href="/tags/vanilla.html">vanilla</a></li>
                            
                        </ul>
                    </li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>

	
	<h1>Apache Commons Math - RealMatrix</h1>

	<p><em><span class="glyphicon glyphicon-calendar"></span> 11 August 2016</em> ~ <a href='/tags/blog.html'><span class='label label-success'><span class='glyphicon glyphicon-tag'></span> blog</span></a>, <a href='/tags/groovy.html'><span class='label label-success'><span class='glyphicon glyphicon-tag'></span> groovy</span></a></p>

	<p><div class="paragraph">
<p>I have been reading <a href="https://www.manning.com/books/machine-learning-in-action">Machine Learning in Action</a>, which is a great book; however, all of the examples are in Python. While Python seems like a decent language, it is not one of my primary languages. With that in mind, I have been converting the Python examples into Groovy so that a few months from now when I come back and try to understand what I learned, I will be able to decipher the code.</p>
</div>
<div class="paragraph">
<p>What I have found is that, at least in the examples for this book, there are numerous Matrix-based operations. My Linear Algebra was a long time ago, but I think I remember some of the basics; however, it&#8217;s nice to have a Java-based implementation in the <a href="http://commons.apache.org/proper/commons-math/">Apache Commons Math</a> <code>RealMatrix</code> implementations (there are others but this is what I have been focussing on). It took me a little time to get back up to speed, especially since the Python examples will have something like:</p>
</div>
<div class="paragraph">
<p>someMatrix = someMatrix * anotherMatrix + thirdMatrix * number</p>
</div>
<div class="paragraph">
<p>where the resulting matrix is the product of two matrices added to the product of a matrix and a scalar number. Conceptually, this boils down to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Multiply <code>someMatrix</code> by <code>anotherMatrix</code></p>
</li>
<li>
<p>Multiply every element of <code>thirdMatrix</code> by the scalar <code>number</code> value</p>
</li>
<li>
<p>Add every element of the matrix in step 1 with the element at the same position of the matrix from step 2.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Not hard to grasp, and not even all that hard to code; however, this is something I&#8217;d rather push off to someone else&#8217;s implementation instead of writing it myself. That is where the Commons Math library comes into play. The <code>RealMatrix</code> interface defines matrix support for <code>double</code> values - there is also a more flexible <code>FieldMatrix&lt;T&gt;</code> interface, but <code>double</code> values work well as an example. Let&#8217;s start by setting up a simple Groovy script for playing with matrices. Create a file named <code>matrix-math.groovy</code> and add the following to it:</p>
</div>
<div class="listingblock">
<div class="title">matrix-math.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">@Grapes(
   @Grab('org.apache.commons:commons-math3:3.6.1')
)

import org.apache.commons.math3.linear.*

def mat = new Array2DRowRealMatrix(4,3)

println mat</code></pre>
</div>
</div>
<div class="paragraph">
<p>This script will download the artifacts for the Apache Commons Math library and create a simple <code>RealMatrix</code> with 4 rows and 3 columns. It will then be printed to the console. When you run it, you should see</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Array2DRowRealMatrix{{0.0,0.0,0.0},{0.0,0.0,0.0},{0.0,0.0,0.0},{0.0,0.0,0.0}}</pre>
</div>
</div>
<div class="paragraph">
<p>which represents our empty 4x3 matrix. While this is not a bad representation, it would be nicer if we could get a better representation of the rows and columns of data for our poor human eyes. The library provides a <code>RealMatrixFormat</code> for this. Add the following to the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def formatter = new RealMatrixFormat('{', '}', '{', '}', ',\n ', ',\t')

println formatter.format(mat)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>println</code> line replaces the existing one. Now we get a better, more human-readable representation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{{0,    0,      0},
 {0,    0,      0},
 {0,    0,      0},
 {0,    0,      0}}</pre>
</div>
</div>
<div class="paragraph">
<p>Interesting so far, but we would really like some data. With the existing matrix, you can add data in rows or columns by index, similar to an array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">mat.setRow(0, [1.0, 2.0, 3.0] as double[])
mat.setColumn(1, [9.0, 8.0, 7.0, 6.0] as double[])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when you run the code, notice that you get the first row and the second column populated with the provided data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{{1,    9,      3},
 {0,    8,      0},
 {0,    7,      0},
 {0,    6,      0}}</pre>
</div>
</div>
<div class="paragraph">
<p>Also notice that the column data overwrote the row data we set for the second column (index 1). In our row data it was <code>2.0</code>, but the <code>9.0</code> value from the column was applied after and is the final value. The other main method of creating a matrix is by providing the data directly in the constructor. Say we want to create a matrix with the same dimensions, but with a sequential collection of values, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1  2  3
4  5  6
7  8  9
10 11 12</pre>
</div>
</div>
<div class="paragraph">
<p>You can do the following in the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def seqMat = new Array2DRowRealMatrix([
    [1.0, 2.0, 3.0] as double[],
    [4.0, 5.0, 6.0] as double[],
    [7.0, 8.0, 9.0] as double[],
    [10.0, 11.0, 12.0] as double[]
] as double[][])

println formatter.format(seqMat)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code creates a matrix with an array of arrays, where the inner arrays are the rows of data. When printed out, you get the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{{1,    2,      3},
 {4,    5,      6},
 {7,    8,      9},
 {10,   11,     12}}</pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s do some operations on our matrices. You can do common math operations on two matrices. Adding two matrices:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def sum = mat.add(seqMat)
println formatter.format(sum)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This gives you the element-by-element sum of the values and yields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{{2,    11,     6},
 {4,    13,     6},
 {7,    15,     9},
 {10,   17,     12}}</pre>
</div>
</div>
<div class="paragraph">
<p>Subtracting one matrix from another:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def diff = seqMat.subtract(mat)
println formatter.format(diff)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{{0,    -7,     0},
 {4,    -3,     6},
 {7,    1,      9},
 {10,   5,      12}}</pre>
</div>
</div>
<div class="paragraph">
<p>Multiplication of matrices is not what you might intuitively think it is, unless you are up on your Linear Algebra. Since there are whole wiki pages devoted to <a href="https://en.wikipedia.org/wiki/Matrix_multiplication">Matrix Multiplication</a>, I won&#8217;t go into it here beyond stating that it can be done when you have square matrices (ours are not). Not being a tutorial on Linear Algebra, I am going to leave it at that. You can also multiply a matrix by a scalar number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def prod = mat.scalarMultiply(2)
println formatter.format(prod)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which multiplies every element by the given value and results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{{2,    18,     6},
 {0,    16,     0},
 {0,    14,     0},
 {0,    12,     0}}</pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, there is a <code>scalarAdd(double)</code> method.</p>
</div>
<div class="paragraph">
<p>Other useful operations may be performed on matrices. You can "transpose" the matrix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def trans = seqMat.transpose()
println formatter.format(trans)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This rotates the values of the matrix to turn rows into columns, as in our example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{{1,    2,      3},
 {4,    5,      6},
 {7,    8,      9},
 {10,   11,     12}}</pre>
</div>
</div>
<div class="paragraph">
<p>becomes</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{{1,    4,      7,      10},
 {2,    5,      8,      11},
 {3,    6,      9,      12}}</pre>
</div>
</div>
<div class="paragraph">
<p>There are a handful of other built-in operations available to matrices that are probably useful if you know what you are doing, but at this point, I do not. Another useful construct is the set of "walker" methods that allow you to walk through the elements of the matrix in various ways, allowing you to modify the elements or simply read them. Let&#8217;s take our initial matrix as an example and multiply every element by <code>2.0</code> both in place and in an external collection.</p>
</div>
<div class="paragraph">
<p>For the in-place modification we need a <code>RealMatrixChangingVisitor</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class MultiplicationVisitor extends DefaultRealMatrixChangingVisitor {

    double factor

    double visit(int row, int column, double value){
        value * factor
    }
}

mat.walkInOptimizedOrder(new MultiplicationVisitor(factor:2.0))
println formatter.format(mat)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This visitor simply multiplies each value by the provided <code>factor</code> and returns it, which will update the value in the matrix. The resulting matrix has the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{{2,    18,     6},
 {0,    16,     0},
 {0,    14,     0},
 {0,    12,     0}}</pre>
</div>
</div>
<div class="paragraph">
<p>You can also walk a matrix without the ability to change the internal values. This requires a <code>RealMatrixPreservingVisitor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class CollectingVisitor extends DefaultRealMatrixPreservingVisitor {

    List values = []

    void visit(int row, int column, double value){
        values &lt;&lt; value
    }
}

def collectingVisitor = new CollectingVisitor()
mat.walkInOptimizedOrder(collectingVisitor)
println collectingVisitor.values</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the values are collected into a list and no matrix value is modified. You get the following result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[2.0, 18.0, 6.0, 0.0, 16.0, 0.0, 0.0, 14.0, 0.0, 0.0, 12.0, 0.0]</pre>
</div>
</div>
<div class="paragraph">
<p>This contains a list of all the values from our original matrix after the previous visitor has modified it.</p>
</div>
<div class="paragraph">
<p>Matrix operations can seem quite complicated; however, they are not bad with a helpful library. So far the Commons Math API seems pretty useful for these more advanced math concepts.</p>
</div>
<div class="paragraph">
<p>The entire script for this tutorial is provided below for completeness:</p>
</div>
<div class="listingblock">
<div class="title">matrix-math.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">@Grapes(
   @Grab('org.apache.commons:commons-math3:3.6.1')
)

import org.apache.commons.math3.linear.*

def formatter = new RealMatrixFormat('{', '}', '{', '}', ',\n ', ',\t')

def mat = new Array2DRowRealMatrix(4,3)
mat.setRow(0, [1.0, 2.0, 3.0] as double[])
mat.setColumn(1, [9.0, 8.0, 7.0, 6.0] as double[])

println formatter.format(mat)
println()

def seqMat = new Array2DRowRealMatrix([
    [1.0, 2.0, 3.0] as double[],
    [4.0, 5.0, 6.0] as double[],
    [7.0, 8.0, 9.0] as double[],
    [10.0, 11.0, 12.0] as double[]
] as double[][])

println formatter.format(seqMat)
println()

def sum = mat.add(seqMat)
println formatter.format(sum)
println()

def diff = seqMat.subtract(mat)
println formatter.format(diff)
println()

def prod = mat.scalarMultiply(2)
println formatter.format(prod)
println()

def trans = seqMat.transpose()
println formatter.format(trans)
println()

class MultiplicationVisitor extends DefaultRealMatrixChangingVisitor {

    double factor

    double visit(int row, int column, double value){
        value * factor
    }
}

mat.walkInOptimizedOrder(new MultiplicationVisitor(factor:2.0))
println formatter.format(mat)
println()

class CollectingVisitor extends DefaultRealMatrixPreservingVisitor {

    List values = []

    void visit(int row, int column, double value){
        values &lt;&lt; value
    }
}

def collectingVisitor = new CollectingVisitor()
mat.walkInOptimizedOrder(collectingVisitor)
println collectingVisitor.values
println()</code></pre>
</div>
</div></p>

	<hr />
	

            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <hr>
                    <div style="text-align:center;">
                        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a> CoffeaElectronica.com content is copyright &copy; 2016 <a href="http://stehno.com">Christopher J. Stehno</a> and available under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
                    </div>
                </div>
            </div>

        </div>

        <script src="js/jquery-1.12.4.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/prettify.js"></script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-27165855-1', 'auto');
            ga('send', 'pageview');
        </script>
    </body>
</html>